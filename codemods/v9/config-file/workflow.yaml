version: "1"

nodes:
  - id: apply-transforms
    name: Apply ESLint v8 to v9 Config Migration
    type: automatic
    steps:
      - id: scan-ignore-files
        name: "Scan ignore files"
        js-ast-grep:
          js_file: scripts/ignore-files.ts
          max_threads: 1
          include:
            - "**/.gitignore"
            - "**/.eslintignore"
      - id: fix-exported-comments
        name: "Fix exported comments"
        js-ast-grep:
          js_file: scripts/fix-exported-comment.ts
          include:
            - "**/*.ts"
            - "**/*.js"
      - id: remove-unnecessary-eslint-comments
        name: "Remove unnecessary eslint comments"
        js-ast-grep:
          js_file: scripts/remove-unnecessary-eslint-comments.ts
          include:
            - "**/*.ts"
            - "**/*.js"
      - id: scan-file-jsdoc
        name: "Scan file-jsdoc.ts"
        depends_on:
          - remove-unnecessary-eslint-comments
        js-ast-grep:
          js_file: scripts/file-jsdoc.ts
          include:
            - "**/*.ts"
            - "**/*.js"
      - id: scan-eslintrc-js-and-cjs
        name: "Scan .eslintrc.js and .eslintrc.cjs"
        depends_on:
          - scan-file-jsdoc
          - scan-ignore-files
        js-ast-grep:
          js_file: scripts/transform-js-config.ts
          include:
            - "**/*.eslintrc.js"
            - "**/*.eslintrc.cjs"
      - id: scan-eslintrc-yaml-and-yml
        name: "Scan .eslintrc.yaml and .eslintrc.yml"
        depends_on:
          - scan-file-jsdoc
          - scan-ignore-files
        js-ast-grep:
          js_file: scripts/transform-yaml-config.ts
          include:
            - "**/*.eslintrc.yaml"
            - "**/*.eslintrc.yml"
      - id: scan-eslintrc-json
        name: "Scan .eslintrc.json"
        depends_on:
          - scan-file-jsdoc
          - scan-ignore-files
        js-ast-grep:
          js_file: scripts/transform-json-config.ts
          include:
            - "**/*.eslintrc.json"
      - id: move-eslintrc-files
        name: "move .eslintrc.js, .eslintrc.json, .eslintrc.yaml and .eslintrc.yml to eslint.config.mjs"
        depends_on: [scan-eslintrc-js-and-cjs, scan-eslintrc-yaml-and-yml, scan-eslintrc-json]
        run: '"$CODEMOD_PATH/scripts/move.sh"'
      - id: remove-eslintignore-files
        name: "Remove .eslintignore files"
        run: 'find . -name "*.eslintignore" -type f -delete'
